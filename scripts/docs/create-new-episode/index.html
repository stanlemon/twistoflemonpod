<h1 id="creating-new-episodes---complete-guide" tabindex="-1">Creating New Episodes - Complete Guide</h1>
<p>This guide explains how to use the <code>create-new-episode.js</code> script to fully automate the creation of new podcast episodes.</p>
<h2 id="overview" tabindex="-1">Overview</h2>
<p>The <code>create-new-episode.js</code> script is a complete, automated workflow that:</p>
<ol>
<li>Prompts for episode details interactively</li>
<li>Transcribes the audio using Deepgram</li>
<li>Generates AI summary and keywords using Ollama</li>
<li>Creates both the episode post AND transcript files</li>
<li>Sets up the correct directory structure</li>
<li>Provides next steps for publishing</li>
</ol>
<h2 id="prerequisites" tabindex="-1">Prerequisites</h2>
<p>Before running the script, ensure you have:</p>
<ol>
<li>
<p><strong>Deepgram API Key</strong></p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># Add to .env file:</span>
<span class="token assign-left variable">DEEPGRAM_API_KEY</span><span class="token operator">=</span>your_api_key_here</code></pre>
</li>
<li>
<p><strong>Ollama Installed and Running</strong></p>
<pre class="language-bash"><code class="language-bash">brew <span class="token function">install</span> ollama
brew services start ollama
ollama pull llama3.2:3b</code></pre>
</li>
<li>
<p><strong>MP3 File Ready</strong></p>
<ul>
<li>Audio file should be in a known location</li>
<li>Example: <code>~/Sites/twistoflemonpod-mp3s/episodes/173-new-episode.mp3</code></li>
</ul>
</li>
</ol>
<h2 id="usage" tabindex="-1">Usage</h2>
<h3 id="basic-command" tabindex="-1">Basic Command</h3>
<pre class="language-bash"><code class="language-bash"><span class="token function">node</span> scripts/create-new-episode.js <span class="token operator">&lt;</span>path-to-mp3-file<span class="token operator">></span></code></pre>
<h3 id="example" tabindex="-1">Example</h3>
<pre class="language-bash"><code class="language-bash"><span class="token function">node</span> scripts/create-new-episode.js ~/Sites/twistoflemonpod-mp3s/episodes/173-new-episode.mp3</code></pre>
<h3 id="optional-flags" tabindex="-1">Optional Flags</h3>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--skip-transcription</code></td>
<td>Skips the Deepgram transcription and AI summarization steps. Transcript and episode stubs are still generated with placeholder text so you can fill them in later.</td>
</tr>
<tr>
<td><code>--upload</code></td>
<td>Uploads the provided MP3 to Cloudflare R2 (S3-compatible) after the files are generated. Requires the <code>aws</code> CLI to be configured for your R2 bucket.</td>
</tr>
</tbody>
</table>
<p>When using <code>--upload</code>, you can configure the destination via environment variables:</p>
<pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">R2_BUCKET</span><span class="token operator">=</span><span class="token string">"s3://twistoflemonpod/episodes"</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">R2_ENDPOINT_URL</span><span class="token operator">=</span><span class="token string">"https://&lt;account-id>.r2.cloudflarestorage.com"</span></code></pre>
<p>If you skip transcription now but want an AI summary later, run the dedicated script once you have the transcript ready:</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">node</span> scripts/add-ai-summaries.js <span class="token parameter variable">--file</span><span class="token operator">=</span>content/blog/2025-11-15/173-lwatol-20251115.md</code></pre>
<h3 id="interactive-prompts" tabindex="-1">Interactive Prompts</h3>
<p>The script will prompt you for:</p>
<ol>
<li><strong>Episode number</strong> (e.g., <code>173</code>)</li>
<li><strong>Episode title</strong> (e.g., <code>New Adventures in Podcasting</code>)</li>
<li><strong>Publish date</strong> (format: <code>YYYY-MM-DD</code>, or press Enter for today)</li>
</ol>
<p>Example interaction:</p>
<pre><code>Episode number: 173
Episode title: New Adventures in Podcasting
Publish date (YYYY-MM-DD) [today]: 2025-11-15
</code></pre>
<h2 id="what-gets-created" tabindex="-1">What Gets Created</h2>
<p>The script creates the following files in <code>content/blog/YYYY-MM-DD/</code>:</p>
<h3 id="1.-episode-post-(nnn-slug.md)" tabindex="-1">1. Episode Post (<code>NNN-slug.md</code>)</h3>
<p>Main episode file with:</p>
<ul>
<li>Title, slug, episode number</li>
<li>Categories (defaults to &quot;Technology&quot;)</li>
<li>Tags (from AI keywords)</li>
<li>Enclosure metadata (URL, file size, duration)</li>
<li>AI-generated summary</li>
<li>Basic episode content template</li>
</ul>
<p>Example: <code>content/blog/2025-11-15/173-new-adventures-in-podcasting.md</code></p>
<h3 id="2.-transcript-file-(nnn-lwatol-yyyymmdd.md)" tabindex="-1">2. Transcript File (<code>NNN-lwatol-YYYYMMDD.md</code>)</h3>
<p>Transcript file with:</p>
<ul>
<li>Complete transcription with speaker labels and timestamps</li>
<li>Episode metadata</li>
<li>AI-generated summary and keywords</li>
<li>Type marked as <code>transcript</code></li>
</ul>
<p>Example: <code>content/blog/2025-11-15/173-lwatol-20251115.md</code></p>
<h2 id="after-running-the-script" tabindex="-1">After Running the Script</h2>
<p>The script will print next steps:</p>
<ol>
<li>
<p><strong>Review the generated files</strong></p>
<ul>
<li>Check episode content and edit as needed</li>
<li>Update categories if needed</li>
<li>Review tags (generated from keywords)</li>
</ul>
</li>
<li>
<p><strong>Upload MP3 to Cloudflare R2 (or S3)</strong></p>
<ul>
<li>Run this manually if you skipped the <code>--upload</code> flag</li>
</ul>
<pre class="language-bash"><code class="language-bash">aws s3 <span class="token function">cp</span> ~/path/to/episode.mp3 s3://twistoflemonpod/episodes/</code></pre>
<ul>
<li>When <code>--upload</code> is used the script runs this step for you</li>
</ul>
</li>
<li>
<p><strong>Test and build</strong></p>
<pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token builtin class-name">test</span> <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run build</code></pre>
</li>
<li>
<p><strong>Commit and deploy</strong></p>
<pre class="language-bash"><code class="language-bash"><span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"Add episode 173: New Adventures in Podcasting"</span>
<span class="token function">git</span> push</code></pre>
</li>
</ol>
<h2 id="script-architecture" tabindex="-1">Script Architecture</h2>
<h3 id="shared-utilities-(scripts%2Flib%2Futils.js)" tabindex="-1">Shared Utilities (<code>scripts/lib/utils.js</code>)</h3>
<p>All episode processing scripts now share common code:</p>
<ul>
<li>
<p><strong>Deepgram Functions:</strong></p>
<ul>
<li><code>transcribeFile()</code>: Transcribe audio with speaker diarization</li>
<li><code>formatTranscript()</code>: Format result as markdown</li>
<li><code>formatTimestamp()</code>: Convert seconds to HH:MM:SS</li>
</ul>
</li>
<li>
<p><strong>Ollama Functions:</strong></p>
<ul>
<li><code>checkOllama()</code>: Verify Ollama is running</li>
<li><code>callOllama()</code>: Call Ollama API</li>
<li><code>generateSummary()</code>: Generate summary and keywords</li>
<li><code>createSummaryPrompt()</code>: Build prompt for AI</li>
<li><code>parseAIResponse()</code>: Parse AI response</li>
</ul>
</li>
<li>
<p><strong>File Operations:</strong></p>
<ul>
<li><code>ensureDir()</code>: Create directory if needed</li>
<li><code>writeMarkdownFile()</code>: Write file with frontmatter</li>
<li><code>readMarkdownFile()</code>: Read file with frontmatter</li>
<li><code>getFileSize()</code>: Get file size in bytes</li>
</ul>
</li>
<li>
<p><strong>Utility Functions:</strong></p>
<ul>
<li><code>formatDateForDir()</code>: Format date as YYYY-MM-DD</li>
<li><code>parseDate()</code>: Parse date string to Date object</li>
<li><code>slugify()</code>: Convert title to URL slug</li>
<li><code>prompt()</code>: Interactive user input</li>
</ul>
</li>
</ul>
<h3 id="related-scripts" tabindex="-1">Related Scripts</h3>
<ul>
<li><strong><code>transcribe-with-deepgram.js</code></strong>: Standalone transcription (outputs .md file)</li>
<li><strong><code>add-ai-summaries.js</code></strong>: Add summaries to existing transcripts</li>
<li><strong><code>batch-transcribe-deepgram.js</code></strong>: Batch process multiple episodes</li>
</ul>
<p>All scripts now use the shared utilities from <code>scripts/lib/utils.js</code>.</p>
<h2 id="troubleshooting" tabindex="-1">Troubleshooting</h2>
<h3 id="deepgram-api-error" tabindex="-1">Deepgram API Error</h3>
<pre><code>Error: DEEPGRAM_API_KEY environment variable is not set
</code></pre>
<p><strong>Solution:</strong> Add your API key to <code>.env</code> file</p>
<h3 id="ollama-not-running" tabindex="-1">Ollama Not Running</h3>
<pre><code>Error: Ollama is not running
</code></pre>
<p><strong>Solution:</strong></p>
<pre class="language-bash"><code class="language-bash">brew services start ollama
<span class="token comment"># or</span>
ollama serve</code></pre>
<h3 id="missing-model" tabindex="-1">Missing Model</h3>
<pre><code>Error: Model not found
</code></pre>
<p><strong>Solution:</strong></p>
<pre class="language-bash"><code class="language-bash">ollama pull llama3.2:3b</code></pre>
<h3 id="invalid-date-format" tabindex="-1">Invalid Date Format</h3>
<pre><code>Please enter a valid date in YYYY-MM-DD format
</code></pre>
<p><strong>Solution:</strong> Use format like <code>2025-11-15</code> or press Enter for today</p>
<h2 id="tips" tabindex="-1">Tips</h2>
<ol>
<li><strong>Episode Numbering:</strong> Use the next sequential episode number</li>
<li><strong>Title Best Practices:</strong> Keep titles descriptive but concise</li>
<li><strong>Future Dating:</strong> You can set a future date for scheduled publishing</li>
<li><strong>Categories:</strong> Default is &quot;Technology&quot; but can be edited after generation</li>
<li><strong>Tags:</strong> Generated from AI keywords, review and adjust as needed</li>
<li><strong>S3 Upload:</strong> Remember to upload the MP3 before deploying the site</li>
</ol>
<h2 id="example-workflow" tabindex="-1">Example Workflow</h2>
<p>Complete workflow for adding episode 173:</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># 1. Run the script</span>
<span class="token function">node</span> scripts/create-new-episode.js ~/Sites/twistoflemonpod-mp3s/episodes/173-new-episode.mp3

<span class="token comment"># Answer prompts:</span>
<span class="token comment"># Episode number: 173</span>
<span class="token comment"># Episode title: New Adventures in Podcasting</span>
<span class="token comment"># Publish date (YYYY-MM-DD) [today]: &lt;Enter></span>

<span class="token comment"># 2. Review generated files</span>
<span class="token function">cat</span> content/blog/2025-11-10/173-new-adventures-in-podcasting.md

<span class="token comment"># 3. Upload to S3</span>
aws s3 <span class="token function">cp</span> ~/Sites/twistoflemonpod-mp3s/episodes/173-new-episode.mp3 <span class="token punctuation">\</span>
  s3://twistoflemonpod/episodes/

<span class="token comment"># 4. Test and build</span>
<span class="token function">npm</span> <span class="token builtin class-name">test</span> <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run build

<span class="token comment"># 5. Commit</span>
<span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"Add episode 173: New Adventures in Podcasting"</span>

<span class="token comment"># 6. Deploy</span>
<span class="token function">git</span> push</code></pre>
<h2 id="advanced%3A-code-reuse" tabindex="-1">Advanced: Code Reuse</h2>
<p>If you're creating custom scripts, you can import the shared utilities:</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span>
  transcribeFile<span class="token punctuation">,</span>
  generateSummary<span class="token punctuation">,</span>
  writeMarkdownFile<span class="token punctuation">,</span>
  slugify<span class="token punctuation">,</span>
  formatTimestamp
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./lib/utils.js'</span><span class="token punctuation">;</span>

<span class="token comment">// Use the functions in your script</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">transcribeFile</span><span class="token punctuation">(</span><span class="token string">'path/to/audio.mp3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> summary<span class="token punctuation">,</span> keywords <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">generateSummary</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> transcript<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This ensures consistency across all episode processing scripts.</p>
